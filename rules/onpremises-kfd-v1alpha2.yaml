# Copyright (c) 2017-present SIGHUP s.r.l All rights reserved.
# Use of this source code is governed by a BSD-style
# license that can be found in the LICENSE file.

---

kubernetes: 
  - path: .spec.kubernetes.dnsZone
    immutable: true
  - path: .spec.kubernetes.controlPlaneAddress
    immutable: true
  - path: .spec.kubernetes.podCidr
    immutable: true
  - path: .spec.kubernetes.svcCidr
    immutable: true
distribution: 
  - path: .spec.distribution.modules.networking.type
    immutable: true
  - path: .spec.distribution.modules.logging.type
    immutable: false
    description: "changes to the logging module type have been detected. This will cause the reconfiguration or deletion of the current logging stack."
    unsupported:
      - to: none
        reason: "currently, removing the logging stack is not supported."
    reducers:
      - key: distributionModulesLoggingType
        lifecycle: pre-apply
  - path: .spec.distribution.modules.monitoring.alertmanager.installDefaultRules
    immutable: false
    description: "changes to the monitoring alertmanager configs have been detected. This will cause the reconfiguration (creation or deletion of the defaults alertmanager configs."
    reducers:
      - key: distributionModulesMonitoringAlertmanagerInstalldefaultrules
        lifecycle: pre-apply
  - path: .spec.distribution.modules.policy.type
    immutable: false
    description: "changes to the policy module type have been detected. This will cause the reconfiguration or deletion of the current policy stack."
    unsupported:
      - to: gatekeeper
        from: kyverno
        reason: "currently, switching from kyverno to gatekeeper is not supported. You need to first remove the current stack with type: none."
      - to: kyverno
        from: gatekeeper
        reason: "currently, switching from gatekeeper to kyverno is not supported. You need to first remove the current stack with type: none."
    reducers:
      - key: distributionModulesPolicyType
        lifecycle: pre-apply
  - path: .spec.distribution.modules.tracing.type
    immutable: false
    description: "changes to the tracing module type have been detected. This will cause the replacement of the current tracing stack (removal or creation)."
    reducers:
      - key: distributionModulesTracingType
        lifecycle: pre-apply
  - path: .spec.distribution.modules.tracing.tempo.backend
    immutable: false
    description: "changes to the tempo backend have been detected. This will cause the reconfiguration of tempo and the deletion of the current minio storage, if minio was disabled"
    reducers:
      - key: distributionModulesTracingTempoBackend
        lifecycle: pre-apply
