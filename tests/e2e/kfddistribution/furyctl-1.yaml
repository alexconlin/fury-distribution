# Copyright (c) 2017-present SIGHUP s.r.l All rights reserved.
# Use of this source code is governed by a BSD-style
# license that can be found in the LICENSE file.

---
apiVersion: kfd.sighup.io/v1alpha2
kind: KFDDistribution
metadata:
  name: sighup
spec:
  distributionVersion: v1.27.2
  # This section describes how the KFD distribution will be installed
  distribution:
    kubeconfig: "{env://KUBECONFIG}"
    # This common configuration will be applied to all the packages that will be installed in the cluster
    common:
      nodeSelector:
        beta.kubernetes.io/arch: amd64
    # This section contains all the configurations for all the KFD core modules
    modules:
      networking: 
        type: cilium
        cilium: 
          maskSize: "22"
          podCidr: "10.0.1.2/16"
      # This section contains all the configurations for the ingress module
      ingress:
        baseDomain: fury.sighup.io
        nginx:
          type: single
          tls:
            provider: certManager
        certManager:
          clusterIssuer:
            name: letsencrypt-fury
            email: sighup@sighup.io
            type: http01
            
      logging:
        type: loki
        loki: 
          backend: minio
        minio:
          storageSize: 20Gi
          rootUser:
            username: sighup
            password: secretpassword1
      monitoring:
        type: mimir
        mimir: 
          backend: minio
        minio:
          storageSize: 20Gi
          rootUser:
            username: sighup
            password: secretpassword2
      tracing:
        type: tempo
        tempo: 
          backend: minio
        minio:
          storageSize: 20Gi
          rootUser:
            username: sighup
            password: secretpassword3
      policy:
        type: kyverno
        kyverno:
          additionalExcludedNamespaces: ["local-path-storage"]
          installDefaultPolicies: true
          validationFailureAction: enforce
      dr:
        type: on-premises
        velero: 
          backend: minio
      auth:
        provider:
          type: none
  plugins:
    kustomize: 
      - name: cert-manager-secret
        folder: ./cert-manager-secret/
      - name: storage
        folder: https://github.com/rancher/local-path-provisioner/deploy?ref=v0.0.24